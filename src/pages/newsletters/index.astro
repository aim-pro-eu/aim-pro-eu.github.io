---
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.vue';
import Footer from '../../components/Footer.vue';
import { getCollection } from 'astro:content';

const newsletters = (await getCollection('newsletters')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-GB', { month: 'long', year: 'numeric' }).format(date);
};
---

<Layout title="Newsletters | AIM-PRO">
  <Navbar client:load />

  <main class="pt-24 pb-20 bg-slate-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-12 text-center">
      <h1 class="text-3xl font-extrabold text-slate-900 sm:text-4xl">Project Newsletters</h1>
      <p class="mt-4 text-xl text-slate-500">Monthly updates and social media highlights.</p>
    </div>

    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">
      {newsletters.map((nl) => (
        <a href={`/newsletters/${nl.slug}`} class="block group">
          <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-slate-200 hover:border-blue-300 hover:shadow-lg transition-all duration-300 flex flex-col md:flex-row gap-6 items-center">
            
            {/* Image de couverture (thumbnail) */}
            <div class="w-full md:w-1/3 h-48 md:h-40 rounded-xl overflow-hidden bg-slate-100 flex-shrink-0">
              {nl.data.coverImage ? (
                <img src={nl.data.coverImage} alt="" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-4xl">ðŸ“§</div>
              )}
            </div>

            {/* Contenu */}
            <div class="flex-1 text-center md:text-left">
              <div class="inline-block px-3 py-1 bg-blue-50 text-blue-700 text-xs font-bold uppercase tracking-wider rounded-full mb-3">
                {formatDate(nl.data.date)}
              </div>
              <h2 class="text-2xl font-bold text-slate-900 mb-2 group-hover:text-blue-700 transition-colors">
                {nl.data.title}
              </h2>
              <div class="text-slate-600 line-clamp-2 prose prose-sm">
                {nl.data.intro}
              </div>
              <span class="inline-block mt-4 text-blue-600 font-medium text-sm group-hover:underline">
                Read full issue &rarr;
              </span>
            </div>
          </div>
        </a>
      ))}
    </div>
  </main>

<Footer client:visible />
</Layout>